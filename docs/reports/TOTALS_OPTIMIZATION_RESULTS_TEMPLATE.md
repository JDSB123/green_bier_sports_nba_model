# Totals Market Optimization Results

## Executive Summary

This document provides the results of comprehensive backtesting and parameter optimization for NBA totals betting markets (Full Game and First Half).

**Date**: [TO BE FILLED AFTER RUNNING]
**Markets Analyzed**: FG Totals, 1H Totals
**Historical Data**: 2023-24, 2024-25, 2025-26 seasons
**Total Games Analyzed**: [TO BE FILLED]
**Optimization Method**: Grid search over confidence (0.55-0.79) and edge (0.0-6.0) thresholds

---

## Current vs Optimized Parameters

### Full Game (FG) Totals

| Parameter | Current (Production) | Optimized (Recommended) | Change |
|-----------|---------------------|-------------------------|--------|
| Min Confidence | 0.72 | [TO BE FILLED] | [TO BE FILLED] |
| Min Edge | 3.0 points | [TO BE FILLED] | [TO BE FILLED] |

**Performance Improvement:**
- Baseline ROI: [TO BE FILLED]
- Optimized ROI: [TO BE FILLED]
- Improvement: [TO BE FILLED] percentage points

### First Half (1H) Totals

| Parameter | Current (Production) | Optimized (Recommended) | Change |
|-----------|---------------------|-------------------------|--------|
| Min Confidence | 0.66 | [TO BE FILLED] | [TO BE FILLED] |
| Min Edge | 2.0 points | [TO BE FILLED] | [TO BE FILLED] |

**Performance Improvement:**
- Baseline ROI: [TO BE FILLED]
- Optimized ROI: [TO BE FILLED]
- Improvement: [TO BE FILLED] percentage points

---

## Detailed Results

### FG Totals - Top 10 Parameter Combinations

| Rank | Confidence | Edge | Bets | Accuracy | ROI | Profit |
|------|-----------|------|------|----------|-----|--------|
| 1 | [FILL] | [FILL] | [FILL] | [FILL]% | [FILL]% | [FILL]u |
| 2 | [FILL] | [FILL] | [FILL] | [FILL]% | [FILL]% | [FILL]u |
| 3 | [FILL] | [FILL] | [FILL] | [FILL]% | [FILL]% | [FILL]u |
| 4 | [FILL] | [FILL] | [FILL] | [FILL]% | [FILL]% | [FILL]u |
| 5 | [FILL] | [FILL] | [FILL] | [FILL]% | [FILL]% | [FILL]u |
| 6 | [FILL] | [FILL] | [FILL] | [FILL]% | [FILL]% | [FILL]u |
| 7 | [FILL] | [FILL] | [FILL] | [FILL]% | [FILL]% | [FILL]u |
| 8 | [FILL] | [FILL] | [FILL] | [FILL]% | [FILL]% | [FILL]u |
| 9 | [FILL] | [FILL] | [FILL] | [FILL]% | [FILL]% | [FILL]u |
| 10 | [FILL] | [FILL] | [FILL] | [FILL]% | [FILL]% | [FILL]u |

### 1H Totals - Top 10 Parameter Combinations

| Rank | Confidence | Edge | Bets | Accuracy | ROI | Profit |
|------|-----------|------|------|----------|-----|--------|
| 1 | [FILL] | [FILL] | [FILL] | [FILL]% | [FILL]% | [FILL]u |
| 2 | [FILL] | [FILL] | [FILL] | [FILL]% | [FILL]% | [FILL]u |
| 3 | [FILL] | [FILL] | [FILL] | [FILL]% | [FILL]% | [FILL]u |
| 4 | [FILL] | [FILL] | [FILL] | [FILL]% | [FILL]% | [FILL]u |
| 5 | [FILL] | [FILL] | [FILL] | [FILL]% | [FILL]% | [FILL]u |
| 6 | [FILL] | [FILL] | [FILL] | [FILL]% | [FILL]% | [FILL]u |
| 7 | [FILL] | [FILL] | [FILL] | [FILL]% | [FILL]% | [FILL]u |
| 8 | [FILL] | [FILL] | [FILL] | [FILL]% | [FILL]% | [FILL]u |
| 9 | [FILL] | [FILL] | [FILL] | [FILL]% | [FILL]% | [FILL]u |
| 10 | [FILL] | [FILL] | [FILL] | [FILL]% | [FILL]% | [FILL]u |

---

## Key Insights

### FG Totals Analysis

**Pattern Observations:**
- [TO BE FILLED - e.g., "Higher confidence thresholds (0.73+) provide better ROI but reduce volume"]
- [TO BE FILLED - e.g., "Edge threshold of 3.5-4.0 appears optimal for this market"]
- [TO BE FILLED - e.g., "Sweet spot found at confidence=0.75, edge=3.5 with 156 bets and 4.2% ROI"]

**Recommended Strategy:**
- [TO BE FILLED - e.g., "Conservative: Use confidence>=0.75, edge>=4.0 for maximum ROI (~5%)"]
- [TO BE FILLED - e.g., "Balanced: Use confidence>=0.73, edge>=3.5 for good ROI (~4%) with more volume"]
- [TO BE FILLED - e.g., "Aggressive: Use confidence>=0.69, edge>=2.5 for maximum volume with acceptable ROI (~2.5%)"]

### 1H Totals Analysis

**Pattern Observations:**
- [TO BE FILLED - e.g., "Lower thresholds than FG totals indicate more predictable market"]
- [TO BE FILLED - e.g., "Optimal edge threshold around 2.0-2.5 points"]
- [TO BE FILLED - e.g., "Higher bet volume available compared to FG totals"]

**Recommended Strategy:**
- [TO BE FILLED - e.g., "Conservative: Use confidence>=0.71, edge>=3.0 for maximum ROI"]
- [TO BE FILLED - e.g., "Balanced: Use confidence>=0.67, edge>=2.0 for good ROI with more volume"]
- [TO BE FILLED - e.g., "Aggressive: Use confidence>=0.63, edge>=1.5 for maximum volume"]

---

## Statistical Validation

### Bet Volume Analysis

| Market | Baseline Bets | Optimized Bets | Reduction | Statistical Sig. |
|--------|---------------|----------------|-----------|------------------|
| FG Totals | [FILL] | [FILL] | [FILL]% | [✓/✗] (50+ bets) |
| 1H Totals | [FILL] | [FILL] | [FILL]% | [✓/✗] (50+ bets) |

### Break-Even Analysis

At -110 odds, break-even accuracy is **52.38%**

| Market | Optimized Accuracy | Margin Above Break-Even | Risk Assessment |
|--------|-------------------|------------------------|-----------------|
| FG Totals | [FILL]% | [FILL] pp | [Low/Medium/High] |
| 1H Totals | [FILL]% | [FILL] pp | [Low/Medium/High] |

### Confidence Intervals (95%)

Based on bet volume and historical variance:

| Market | ROI | 95% CI | Interpretation |
|--------|-----|--------|----------------|
| FG Totals | [FILL]% | [±FILL]% | [FILL] |
| 1H Totals | [FILL]% | [±FILL]% | [FILL] |

---

## Seasonal Performance Breakdown

### FG Totals by Season

| Season | Bets | Accuracy | ROI | Profit | Notes |
|--------|------|----------|-----|--------|-------|
| 2023-24 | [FILL] | [FILL]% | [FILL]% | [FILL]u | [FILL] |
| 2024-25 | [FILL] | [FILL]% | [FILL]% | [FILL]u | [FILL] |
| 2025-26 | [FILL] | [FILL]% | [FILL]% | [FILL]u | [FILL - YTD] |

### 1H Totals by Season

| Season | Bets | Accuracy | ROI | Profit | Notes |
|--------|------|----------|-----|--------|-------|
| 2023-24 | [FILL] | [FILL]% | [FILL]% | [FILL]u | [FILL] |
| 2024-25 | [FILL] | [FILL]% | [FILL]% | [FILL]u | [FILL] |
| 2025-26 | [FILL] | [FILL]% | [FILL]% | [FILL]u | [FILL - YTD] |

---

## Implementation Roadmap

### Phase 1: Configuration Update (Immediate)

1. **Update `src/config.py`:**
   ```python
   # FG Total thresholds
   total_min_confidence: float = field(
       default_factory=lambda: _env_float_required("FILTER_TOTAL_MIN_CONFIDENCE", [FILL])
   )
   total_min_edge: float = field(
       default_factory=lambda: _env_float_required("FILTER_TOTAL_MIN_EDGE", [FILL])
   )

   # 1H Total thresholds
   fh_total_min_confidence: float = field(
       default_factory=lambda: _env_float_required("FILTER_1H_TOTAL_MIN_CONFIDENCE", [FILL])
   )
   fh_total_min_edge: float = field(
       default_factory=lambda: _env_float_required("FILTER_1H_TOTAL_MIN_EDGE", [FILL])
   )
   ```

2. **Set Environment Variables (Production):**
   ```bash
   export FILTER_TOTAL_MIN_CONFIDENCE=[FILL]
   export FILTER_TOTAL_MIN_EDGE=[FILL]
   export FILTER_1H_TOTAL_MIN_CONFIDENCE=[FILL]
   export FILTER_1H_TOTAL_MIN_EDGE=[FILL]
   ```

### Phase 2: Validation (Week 1)

1. **Backtest on Recent Data:**
   - Run backtest on last 30 days of games
   - Verify metrics match optimization results
   - Check for any data drift or anomalies

2. **Paper Trading:**
   - Log predictions without placing real bets
   - Track performance vs expected metrics
   - Monitor for 1-2 weeks minimum

### Phase 3: Controlled Deployment (Week 2-3)

1. **Limited Live Testing:**
   - Start with 50% of recommended bet size
   - Monitor actual vs expected performance
   - Adjust if significant deviation detected

2. **Performance Monitoring:**
   - Daily tracking of ROI and accuracy
   - Alert if metrics fall below thresholds
   - Weekly performance review

### Phase 4: Full Deployment (Week 4+)

1. **Scale to Full Betting:**
   - Increase to 100% of recommended bet size
   - Continue monitoring all metrics
   - Document any market condition changes

2. **Ongoing Optimization:**
   - Re-run optimization monthly
   - Adjust parameters if market conditions change
   - Track long-term performance trends

---

## Risk Management

### Key Risks

1. **Overfitting Risk**: Parameters optimized on historical data may not perform identically on future data
   - **Mitigation**: Use walk-forward validation, monitor live performance closely

2. **Volume Risk**: Higher thresholds reduce bet volume, potentially reducing overall profit
   - **Mitigation**: Balance ROI vs volume based on bankroll and goals

3. **Market Changes**: NBA scoring trends and betting markets evolve over time
   - **Mitigation**: Regular re-optimization (monthly/quarterly)

4. **Variance Risk**: Short-term results may deviate from long-term expectations
   - **Mitigation**: Maintain proper bankroll management, don't panic on short-term losses

### Position Sizing Recommendations

Based on Kelly Criterion and conservative bankroll management:

| Market | Optimal ROI | Kelly % | Conservative % | Max Bet Size |
|--------|-------------|---------|----------------|--------------|
| FG Totals | [FILL]% | [FILL]% | [FILL]% | [FILL]% of bankroll |
| 1H Totals | [FILL]% | [FILL]% | [FILL]% | [FILL]% of bankroll |

**Note**: Never bet more than 2-3% of bankroll on a single bet, regardless of confidence.

---

## Monitoring & Alerts

### Key Metrics to Track

1. **Daily Metrics:**
   - Number of bets placed
   - Win rate
   - Daily ROI
   - Profit/Loss

2. **Weekly Metrics:**
   - Cumulative ROI vs expected
   - Accuracy trends
   - Volume trends
   - Bankroll growth

3. **Monthly Metrics:**
   - Season-to-date performance
   - Comparison to historical optimization
   - Market condition changes
   - Parameter re-optimization results

### Alert Thresholds

| Metric | Warning Threshold | Critical Threshold | Action |
|--------|-------------------|-------------------|--------|
| Win Rate | < 50% for 20 bets | < 48% for 30 bets | Review parameters |
| ROI | < 0% for 30 bets | < -5% for 50 bets | Pause betting, investigate |
| Volume | < 50% of expected | < 25% of expected | Check data pipeline |
| Bankroll Drawdown | > 10% | > 20% | Reduce bet sizes |

---

## Appendix

### A. Files Generated

- `data/backtest_results/fg_total_optimization.json` - FG totals optimization results
- `data/backtest_results/1h_total_optimization.json` - 1H totals optimization results
- `data/backtest_results/totals_optimization_summary.json` - Combined analysis summary

### B. Scripts Used

- `scripts/optimize_totals_only.py` - Main optimization script
- `scripts/optimize_confidence_thresholds.py` - Alternative optimization using existing framework
- `scripts/analyze_totals_results.py` - Results analysis and reporting
- `scripts/historical_backtest_production.py` - Core backtesting engine

### C. References

- Current configuration: `src/config.py` (FilterThresholds class)
- Production models: `models/production/fg_total_model.joblib`, `models/production/1h_total_model.joblib`
- Training data: `data/processed/training_data.csv`

### D. Glossary

- **Confidence**: Model's probability prediction (0-1 scale, higher = more certain)
- **Edge**: Difference between model prediction and betting line (in points)
- **ROI**: Return on investment (profit / total wagered × 100)
- **Unit**: Standard bet size (typically 1% of bankroll)
- **Juice**: Bookmaker's commission (typically -110 = risk $110 to win $100)
- **Break-even**: Minimum win rate needed to profit (52.38% at -110 odds)

---

## Contact & Support

For questions or issues with this optimization:
- Review the optimization guide: `TOTALS_OPTIMIZATION_GUIDE.md`
- Check console logs from optimization runs
- Validate data quality in `data/processed/training_data.csv`
- Ensure production models are up to date

---

**Last Updated**: [TO BE FILLED]
**Next Scheduled Optimization**: [TO BE FILLED]
