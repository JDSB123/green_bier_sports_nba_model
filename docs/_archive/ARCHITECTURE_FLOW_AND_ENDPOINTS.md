# Complete Architecture Flow & Endpoint Documentation

## ğŸ—ï¸ System Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          SINGLE ENTRY POINT                                 â”‚
â”‚                    docker-entrypoint-backtest.sh                            â”‚
â”‚                         (Container Entrypoint)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         VALIDATION LAYER                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ validate_env()                                                    â”‚    â”‚
â”‚  â”‚  â”œâ”€ API_BASKETBALL_KEY                                            â”‚    â”‚
â”‚  â”‚  â””â”€ THE_ODDS_API_KEY                                              â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ validate_python()                                                 â”‚    â”‚
â”‚  â”‚  â”œâ”€ Check: src.config, src.modeling.models                       â”‚    â”‚
â”‚  â”‚  â”œâ”€ Check: src.modeling.features                                 â”‚    â”‚
â”‚  â”‚  â””â”€ Check: src.ingestion.api_basketball                           â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DATA INGESTION PIPELINE                                  â”‚
â”‚              scripts/data_unified_build_training_complete.py                   â”‚
â”‚                    FreshDataPipeline.build()                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 1: FETCH PARTICIPANTS (The Odds API)                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚  Function: fetch_participants()                                             â”‚
â”‚  Endpoint: GET /v4/sports/basketball_nba/participants                       â”‚
â”‚  Purpose: Team reference data for validation                                â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚  Response: List of participant objects                                      â”‚
â”‚  Fields: name, id, key, etc.                                                â”‚
â”‚  Standardization: Team names normalized to ESPN format                      â”‚
â”‚  Status: âœ… OPTIMIZED (called at start)                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 2: FETCH GAME OUTCOMES (API-Basketball)                               â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚  Function: FreshDataPipeline.fetch_game_outcomes()                          â”‚
â”‚  Client: APIBasketballClient.ingest_essential()                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ 2.1: FETCH TEAMS                                                   â”‚    â”‚
â”‚  â”‚ Endpoint: GET /v1/teams                                            â”‚    â”‚
â”‚  â”‚ Base URL: https://v1.basketball.api-sports.io                      â”‚    â”‚
â”‚  â”‚ Params: league=12, season={season}                                 â”‚    â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚    â”‚
â”‚  â”‚ Response: { response: [team objects] }                            â”‚    â”‚
â”‚  â”‚ Fields: id, name, code, logo, etc.                                 â”‚    â”‚
â”‚  â”‚ Output: data/raw/api_basketball/teams_*.json                       â”‚    â”‚
â”‚  â”‚ Purpose: Team reference (required for subsequent calls)            â”‚    â”‚
â”‚  â”‚ Status: âœ… OPTIMIZED                                               â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ 2.2: FETCH GAMES                                                   â”‚    â”‚
â”‚  â”‚ Endpoint: GET /v1/games                                            â”‚    â”‚
â”‚  â”‚ Params: league=12, season={season}                                 â”‚    â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚    â”‚
â”‚  â”‚ Response: { response: [game objects] }                            â”‚    â”‚
â”‚  â”‚ Fields:                                                             â”‚    â”‚
â”‚  â”‚   - id, date, status.short (FT = finished)                         â”‚    â”‚
â”‚  â”‚   - teams.home.name, teams.away.name                               â”‚    â”‚
â”‚  â”‚   - scores.home.total, scores.away.total                           â”‚    â”‚
â”‚  â”‚   - scores.home.quarter_1, quarter_2, quarter_3, quarter_4         â”‚    â”‚
â”‚  â”‚   - scores.away.quarter_1, quarter_2, quarter_3, quarter_4         â”‚    â”‚
â”‚  â”‚ Output: data/raw/api_basketball/games_*.json                       â”‚    â”‚
â”‚  â”‚ Standardization: Team names â†’ ESPN format (mandatory)               â”‚    â”‚
â”‚  â”‚ Purpose: Core game data with Q1-Q4 scores                           â”‚    â”‚
â”‚  â”‚ Status: âœ… OPTIMIZED (CORE ENDPOINT)                                â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ 2.3: FETCH STATISTICS                                              â”‚    â”‚
â”‚  â”‚ Endpoint: GET /v1/statistics                                       â”‚    â”‚
â”‚  â”‚ Params: league=12, season={season}, team={team_id}                 â”‚    â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚    â”‚
â”‚  â”‚ Response: { response: {team statistics} }                         â”‚    â”‚
â”‚  â”‚ Fields:                                                             â”‚    â”‚
â”‚  â”‚   - games.minutes, games.points, games.fieldGoals                   â”‚    â”‚
â”‚  â”‚   - Points per game (PPG)                                           â”‚    â”‚
â”‚  â”‚   - Points allowed per game (PAPG)                                  â”‚    â”‚
â”‚  â”‚   - Win-Loss records (home/away)                                    â”‚    â”‚
â”‚  â”‚ Output: data/raw/api_basketball/statistics_*.json                   â”‚    â”‚
â”‚  â”‚ Purpose: Team PPG, PAPG, W-L (key features)                         â”‚    â”‚
â”‚  â”‚ Status: âœ… OPTIMIZED (TIER 1 ESSENTIAL)                             â”‚    â”‚
â”‚  â”‚ Note: Called per team (batch processing)                            â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ 2.4: FETCH GAME STATISTICS (TEAMS)                                 â”‚    â”‚
â”‚  â”‚ Endpoint: GET /v1/games/statistics/teams                           â”‚    â”‚
â”‚  â”‚ Params: ids={game_id1-game_id2-game_id3...}                        â”‚    â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚    â”‚
â”‚  â”‚ Response: { response: [game stats objects] }                      â”‚    â”‚
â”‚  â”‚ Fields:                                                             â”‚    â”‚
â”‚  â”‚   - Full box scores per game                                        â”‚    â”‚
â”‚  â”‚   - Advanced stats (FG%, 3P%, rebounds, assists, etc.)             â”‚    â”‚
â”‚  â”‚ Output: data/raw/api_basketball/game_stats_teams_*.json            â”‚    â”‚
â”‚  â”‚ Purpose: Full box scores for advanced feature engineering           â”‚    â”‚
â”‚  â”‚ Status: âœ… OPTIMIZED (TIER 1 ESSENTIAL)                             â”‚    â”‚
â”‚  â”‚ Note: Batch processing (20 games per call)                          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â”‚  Result: outcomes_df DataFrame with:                                        â”‚
â”‚    - date, home_team, away_team, home_score, away_score                    â”‚
â”‚    - home_q1, home_q2, home_q3, home_q4                                    â”‚
â”‚    - away_q1, away_q2, away_q3, away_q4                                    â”‚
â”‚    - game_id, season                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 3: FETCH BETTING LINES (The Odds API)                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚  Function: FreshDataPipeline.fetch_betting_lines()                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚                                                                              â”‚
â”‚  Strategy: Try historical endpoint first (if paid plan),                    â”‚
â”‚            fallback to current odds with event-specific enrichment          â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ 3.1: FETCH HISTORICAL ODDS (if available)                          â”‚    â”‚
â”‚  â”‚ Endpoint: GET /v4/historical/sports/basketball_nba/odds            â”‚    â”‚
â”‚  â”‚ Base URL: https://api.the-odds-api.com                              â”‚    â”‚
â”‚  â”‚ Params:                                                              â”‚    â”‚
â”‚  â”‚   - apiKey={key}                                                    â”‚    â”‚
â”‚  â”‚   - regions=us                                                      â”‚    â”‚
â”‚  â”‚   - date={ISO date string}                                          â”‚    â”‚
â”‚  â”‚   - oddsFormat=american                                             â”‚    â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚    â”‚
â”‚  â”‚ Response: {                                                         â”‚    â”‚
â”‚  â”‚   data: [event objects],                                            â”‚    â”‚
â”‚  â”‚   timestamp: "...",                                                 â”‚    â”‚
â”‚  â”‚   previous_timestamp: "...",                                        â”‚    â”‚
â”‚  â”‚   next_timestamp: "..."                                             â”‚    â”‚
â”‚  â”‚ }                                                                   â”‚    â”‚
â”‚  â”‚ Fields per event:                                                   â”‚    â”‚
â”‚  â”‚   - id, sport_key, commence_time                                    â”‚    â”‚
â”‚  â”‚   - home_team, away_team                                            â”‚    â”‚
â”‚  â”‚   - bookmakers[].markets[]                                          â”‚    â”‚
â”‚  â”‚     â€¢ spreads: outcomes[].point (spread line)                       â”‚    â”‚
â”‚  â”‚     â€¢ totals: outcomes[].point (total line)                         â”‚    â”‚
â”‚  â”‚ Output: Cached in memory for processing                             â”‚    â”‚
â”‚  â”‚ Purpose: Historical FG markets for backtesting                      â”‚    â”‚
â”‚  â”‚ Status: âœ… OPTIMIZED (requires paid plan Group 2+)                  â”‚    â”‚
â”‚  â”‚ Note: Returns 403 if not enabled                                    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ 3.2: FETCH EVENT-SPECIFIC ODDS (1H Markets)                        â”‚    â”‚
â”‚  â”‚ Endpoint: GET /v4/sports/basketball_nba/events/{eventId}/odds      â”‚    â”‚
â”‚  â”‚ Params:                                                              â”‚    â”‚
â”‚  â”‚   - apiKey={key}                                                    â”‚    â”‚
â”‚  â”‚   - regions=us                                                      â”‚    â”‚
â”‚  â”‚   - markets=spreads_h1,totals_h1                             â”‚    â”‚
â”‚  â”‚   - oddsFormat=american                                             â”‚    â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚    â”‚
â”‚  â”‚ Response: Event object with bookmakers and markets                  â”‚    â”‚
â”‚  â”‚ Markets:                                                             â”‚    â”‚
â”‚  â”‚   - spreads_h1: First half spreads                                  â”‚    â”‚
â”‚  â”‚   - totals_h1: First half totals                                    â”‚    â”‚
â”‚  â”‚ Purpose: 1H markets (not in main /odds endpoint)                    â”‚    â”‚
â”‚  â”‚ Status: âœ… OPTIMIZED (called per event for enrichment)              â”‚    â”‚
â”‚  â”‚ Note: Merged with main event data                                   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ 3.3: FETCH EVENTS LIST (if historical not available)               â”‚    â”‚
â”‚  â”‚ Endpoint: GET /v4/sports/basketball_nba/events                     â”‚    â”‚
â”‚  â”‚ Params:                                                              â”‚    â”‚
â”‚  â”‚   - apiKey={key}                                                    â”‚    â”‚
â”‚  â”‚   - dateFormat=iso                                                  â”‚    â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚    â”‚
â”‚  â”‚ Response: Array of event objects                                    â”‚    â”‚
â”‚  â”‚ Fields: id, sport_key, commence_time, home_team, away_team         â”‚    â”‚
â”‚  â”‚ Purpose: Get event IDs for event-specific endpoint calls           â”‚    â”‚
â”‚  â”‚ Status: âœ… OPTIMIZED (fallback path)                                â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ 3.4: FETCH CURRENT ODDS (fallback)                                 â”‚    â”‚
â”‚  â”‚ Endpoint: GET /v4/sports/basketball_nba/odds                       â”‚    â”‚
â”‚  â”‚ Params:                                                              â”‚    â”‚
â”‚  â”‚   - apiKey={key}                                                    â”‚    â”‚
â”‚  â”‚   - regions=us                                                      â”‚    â”‚
â”‚  â”‚   - oddsFormat=american                                             â”‚    â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚    â”‚
â”‚  â”‚ Response: Array of event objects with bookmakers                   â”‚    â”‚
â”‚  â”‚ Fields: Same as historical odds (current snapshot)                 â”‚    â”‚
â”‚  â”‚ Purpose: Current/recent odds when historical unavailable           â”‚    â”‚
â”‚  â”‚ Status: âœ… OPTIMIZED (fallback path)                                â”‚    â”‚
â”‚  â”‚ Note: Each event then enriched with 1H via event-specific          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â”‚  Result: lines_df DataFrame with:                                           â”‚
â”‚    - query_date, event_id, commence_time                                    â”‚
â”‚    - home_team, away_team (standardized)                                    â”‚
â”‚    - fg_spread_line, fg_total_line, fg_home_ml, fg_away_ml                 â”‚
â”‚    - fh_spread_line, fh_total_line, fh_home_ml, fh_away_ml                 â”‚
â”‚    - 1h_spread_line, 1h_total_line, 1h_home_ml, 1h_away_ml                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 4: MERGE OUTCOMES + LINES                                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚  Function: FreshDataPipeline.merge_outcomes_and_lines()                     â”‚
â”‚  Logic: Match by team names (ESPN format) + date (within 1 day tolerance)   â”‚
â”‚  Result: merged_df with games + betting lines combined                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 5: COMPUTE LABELS                                                     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚  Function: FreshDataPipeline.compute_labels()                               â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚  Computed Labels:                                                           â”‚
â”‚    - home_win = (home_score > away_score)                                   â”‚
â”‚    - spread_covered = (actual_margin > -spread_line)                        â”‚
â”‚    - total_over = (actual_total > total_line)                               â”‚
â”‚    - 1h_spread_covered = (actual_1h_margin > -1h_spread_line)              â”‚
â”‚    - 1h_total_over = (actual_1h_total > 1h_total_line)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 6: ENRICH WITH BETTING SPLITS                                         â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚  Function: FreshDataPipeline.enrich_with_betting_splits()                   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ 6.1: FETCH BETTING SPLITS (The Odds API - Primary)                 â”‚    â”‚
â”‚  â”‚ Endpoint: GET /v4/sports/basketball_nba/betting-splits             â”‚    â”‚
â”‚  â”‚ Params:                                                              â”‚    â”‚
â”‚  â”‚   - apiKey={key}                                                    â”‚    â”‚
â”‚  â”‚   - regions=us                                                      â”‚    â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚    â”‚
â”‚  â”‚ Response: Array of game objects with splits data                   â”‚    â”‚
â”‚  â”‚ Fields:                                                              â”‚    â”‚
â”‚  â”‚   - markets.spreads.choices[].value (public % on each side)        â”‚    â”‚
â”‚  â”‚   - markets.totals.choices[].value                                  â”‚    â”‚
â”‚  â”‚ Purpose: Public betting percentages, RLM detection                  â”‚    â”‚
â”‚  â”‚ Status: âœ… OPTIMIZED (tried first, requires paid plan Group 2+)     â”‚    â”‚
â”‚  â”‚ Note: Returns 403 if not enabled, falls back to Action Network     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ 6.2: FETCH BETTING SPLITS (Action Network - Premium + Public)       â”‚    â”‚
â”‚  â”‚ Endpoint: POST https://api.actionnetwork.com/web/v1/auth/login     â”‚    â”‚
â”‚  â”‚          GET https://api.actionnetwork.com/web/v1/games/nba        â”‚    â”‚
â”‚  â”‚          GET https://api.actionnetwork.com/web/v1/scoreboard/nba   â”‚    â”‚
â”‚  â”‚ Params:                                                              â”‚    â”‚
â”‚  â”‚   - ACTION_NETWORK_USERNAME (optional - enables premium access)     â”‚    â”‚
â”‚  â”‚   - ACTION_NETWORK_PASSWORD (optional - enables premium access)     â”‚    â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚    â”‚
â”‚  â”‚ Response: JSON with betting splits                                  â”‚    â”‚
â”‚  â”‚ Fields: Public percentages, ticket/money splits, expert picks       â”‚    â”‚
â”‚  â”‚ Purpose: Primary betting splits source (premium when available)     â”‚    â”‚
â”‚  â”‚ Status: âœ… ENHANCED (premium auth + public fallback)               â”‚    â”‚
â”‚  â”‚ Note: Premium access provides Action PRO/Labs features              â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â”‚  Added Features:                                                             â”‚
â”‚    - spread_public_home_pct, spread_ticket_money_diff                       â”‚
â”‚    - is_rlm_spread (reverse line movement indicator)                        â”‚
â”‚    - over_public_pct, total_ticket_money_diff                               â”‚
â”‚    - sharp_side_spread, sharp_side_total                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 7: VALIDATE DATASET                                                   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚  Function: FreshDataPipeline.validate_dataset()                             â”‚
â”‚  Checks:                                                                    â”‚
â”‚    - Required columns exist                                                 â”‚
â”‚    - Data quality (null percentages < 20%)                                  â”‚
â”‚    - Spread line coverage (>10%)                                            â”‚
â”‚    - Total line coverage (>10%)                                             â”‚
â”‚  Result: Validated training_data.csv                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 8: SAVE TRAINING DATA                                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚  Output: data/processed/training_data.csv                                   â”‚
â”‚  Columns: ~100+ columns including:                                          â”‚
â”‚    - Core: date, home_team, away_team, home_score, away_score              â”‚
â”‚    - Quarters: home_q1-q4, away_q1-q4                                       â”‚
â”‚    - Labels: spread_covered, total_over, 1h_spread_covered, etc.           â”‚
â”‚    - Lines: spread_line, total_line, fh_spread_line, fh_total_line, etc.   â”‚
â”‚    - Features: (will be computed during backtest)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 9: RUN BACKTEST                                                       â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚  Script: scripts/historical_backtest_production.py                                     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ 9.1: LOAD TRAINING DATA                                            â”‚    â”‚
â”‚  â”‚ Function: load_training_data()                                     â”‚    â”‚
â”‚  â”‚ Input: data/processed/training_data.csv                            â”‚    â”‚
â”‚  â”‚ Output: DataFrame sorted by date                                   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ 9.2: WALK-FORWARD VALIDATION                                       â”‚    â”‚
â”‚  â”‚ For each market (fg_spread, fg_total, 1h_spread, etc.):           â”‚    â”‚
â”‚  â”‚                                                                     â”‚    â”‚
â”‚  â”‚   For game i in range(min_training, total_games):                  â”‚    â”‚
â”‚  â”‚     â”œâ”€ Training data: games[0:i]                                   â”‚    â”‚
â”‚  â”‚     â”œâ”€ Test game: games[i]                                         â”‚    â”‚
â”‚  â”‚     â”‚                                                               â”‚    â”‚
â”‚  â”‚     â””â”€ Build features via FeatureEngineer:                         â”‚    â”‚
â”‚  â”‚         â”œâ”€ compute_team_rolling_stats()                            â”‚    â”‚
â”‚  â”‚         â”‚   â””â”€ Historical games only (< game date)                 â”‚    â”‚
â”‚  â”‚         â”œâ”€ compute_rest_days()                                     â”‚    â”‚
â”‚  â”‚         â”œâ”€ compute_travel_features()                               â”‚    â”‚
â”‚  â”‚         â”œâ”€ compute_dynamic_hca()                                   â”‚    â”‚
â”‚  â”‚         â”œâ”€ compute_sos_features()                                  â”‚    â”‚
â”‚  â”‚         â””â”€ build_game_features() â†’ feature dict                    â”‚    â”‚
â”‚  â”‚                                                                     â”‚    â”‚
â”‚  â”‚     â”œâ”€ Train model on training features                            â”‚    â”‚
â”‚  â”‚     â”‚   â””â”€ Model.fit(X_train, y_train)                             â”‚    â”‚
â”‚  â”‚     â”‚                                                               â”‚    â”‚
â”‚  â”‚     â”œâ”€ Predict on test game                                        â”‚    â”‚
â”‚  â”‚     â”‚   â””â”€ Model.predict_proba(X_test) â†’ probabilities             â”‚    â”‚
â”‚  â”‚     â”‚                                                               â”‚    â”‚
â”‚  â”‚     â””â”€ Calculate accuracy/ROI                                      â”‚    â”‚
â”‚  â”‚         â””â”€ Compare prediction vs actual outcome                    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ 9.3: SAVE RESULTS                                                  â”‚    â”‚
â”‚  â”‚ Output:                                                             â”‚    â”‚
â”‚  â”‚   - data/processed/all_markets_backtest_results.csv                â”‚    â”‚
â”‚  â”‚   - ALL_MARKETS_BACKTEST_RESULTS.md                                â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¡ Complete Endpoint Reference

### API-Basketball (https://v1.basketball.api-sports.io)

| Endpoint | Method | Purpose | Status | Params |
|----------|--------|---------|--------|--------|
| `/v1/teams` | GET | Team reference | âœ… **OPTIMIZED** | `league=12, season={season}` |
| `/v1/games` | GET | Game outcomes + Q1-Q4 | âœ… **OPTIMIZED** | `league=12, season={season}` |
| `/v1/statistics` | GET | Team PPG/PAPG/W-L | âœ… **OPTIMIZED** | `league=12, season={season}, team={id}` |
| `/v1/games/statistics/teams` | GET | Full box scores | âœ… **OPTIMIZED** | `ids={id1-id2-id3...}` |
| `/v1/standings` | GET | Conference rankings | âš ï¸ Optional | `league=12, season={season}` |
| `/v1/games/statistics/players` | GET | Player box scores | âš ï¸ Optional | `ids={id1-id2-id3...}` |
| `/v1/players` | GET | Team rosters | âš ï¸ Optional | `team={id}, season={season}` |

**Tier 1 (Essential - Always Called):**
- âœ… `/teams` - Base reference
- âœ… `/games` - Core outcomes
- âœ… `/statistics` - Team stats
- âœ… `/games/statistics/teams` - Box scores

**Tier 2 (Valuable - Can be added):**
- âš ï¸ `/standings` - Rankings
- âš ï¸ `/games/statistics/players` - Player stats

**Tier 3 (Reference - Static):**
- âš ï¸ `/players` - Rosters
- âš ï¸ `/bookmakers` - Sportsbook names
- âš ï¸ `/bets` - Bet type definitions

---

### The Odds API (https://api.the-odds-api.com)

| Endpoint | Method | Purpose | Status | Params |
|----------|--------|---------|--------|--------|
| `/v4/sports/basketball_nba/participants` | GET | Team reference | âœ… **OPTIMIZED** | `apiKey, dateFormat=iso` |
| `/v4/sports/basketball_nba/events/{eventId}/odds` | GET | 1H markets | âœ… **OPTIMIZED** | `apiKey, regions=us, markets=spreads_h1,totals_h1` |
| `/v4/sports/basketball_nba/events` | GET | Events list | âœ… **OPTIMIZED** | `apiKey, dateFormat=iso` |
| `/v4/sports/basketball_nba/scores` | GET | Recent scores | âš ï¸ Not used | `apiKey, daysFrom=1` |
| `/v4/sports/basketball_nba/betting-splits` | GET | Public betting % | âœ… **OPTIMIZED** | `apiKey, regions=us` |

**Primary Endpoints (Always Called):**
- âœ… `/participants` - Team validation
- âœ… `/historical/.../odds` or `/odds` - FG markets
- âœ… `/events/{id}/odds` - 1H enrichment
- âœ… `/betting-splits` - Public percentages

**Optional Endpoints:**
- âš ï¸ `/scores` - Not used (we use API-Basketball for scores)
- âš ï¸ `/events` - Only used when historical unavailable

---

## ğŸ”„ Complete Data Flow

### Input Data Sources

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  API-Basketball      â”‚         â”‚   The Odds API       â”‚
â”‚                      â”‚         â”‚                      â”‚
â”‚  â€¢ Game outcomes     â”‚         â”‚  â€¢ Betting lines     â”‚
â”‚  â€¢ Q1-Q4 scores      â”‚         â”‚  â€¢ Spreads/totals    â”‚
â”‚  â€¢ Team statistics   â”‚         â”‚  â€¢ 1H markets        â”‚
â”‚  â€¢ Box scores        â”‚         â”‚  â€¢ Betting splits    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                                 â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  Standardization     â”‚
              â”‚  (ESPN format)       â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  Merge & Enrich      â”‚
              â”‚  (Match by teams)    â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  training_data.csv   â”‚
              â”‚  (Complete dataset)  â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  Feature Engineering â”‚
              â”‚  (Historical stats)  â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  Model Training      â”‚
              â”‚  (Walk-forward)      â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  Predictions         â”‚
              â”‚  (Probabilities)     â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Feature Engineering Flow

```
For each game in backtest:
â”‚
â”œâ”€ Historical Data (all games < current game date)
â”‚
â”œâ”€ Build Features:
â”‚  â”œâ”€ Team Rolling Stats (last 10 games)
â”‚  â”‚  â”œâ”€ PPG, PAPG, margin, win_pct
â”‚  â”‚  â”œâ”€ Home/away splits
â”‚  â”‚  â”œâ”€ Form (last 3 vs last 10)
â”‚  â”‚  â”œâ”€ Clutch performance
â”‚  â”‚  â”œâ”€ Opponent-adjusted metrics
â”‚  â”‚  â””â”€ Consistency metrics
â”‚  â”‚
â”‚  â”œâ”€ Context Features
â”‚  â”‚  â”œâ”€ Rest days (home/away)
â”‚  â”‚  â”œâ”€ Back-to-back indicators
â”‚  â”‚  â”œâ”€ Travel distance/fatigue
â”‚  â”‚  â”œâ”€ Timezone changes
â”‚  â”‚  â””â”€ Dynamic HCA
â”‚  â”‚
â”‚  â”œâ”€ Head-to-Head
â”‚  â”‚  â”œâ”€ H2H margin (last 5 games)
â”‚  â”‚  â”œâ”€ H2H win percentage
â”‚  â”‚  â”œâ”€ Recent H2H margin
â”‚  â”‚  â””â”€ H2H total average
â”‚  â”‚
â”‚  â”œâ”€ Strength of Schedule
â”‚  â”‚  â”œâ”€ SOS rating
â”‚  â”‚  â”œâ”€ Recent SOS
â”‚  â”‚  â””â”€ Opponent averages
â”‚  â”‚
â”‚  â”œâ”€ Market Features
â”‚  â”‚  â”œâ”€ Spread/total lines
â”‚  â”‚  â”œâ”€ Line movement
â”‚  â”‚  â”œâ”€ RLM indicators
â”‚  â”‚  â””â”€ Sharp money signals
â”‚  â”‚
â”‚  â”œâ”€ Predictions
â”‚  â”‚  â”œâ”€ predicted_margin (FG)
â”‚  â”‚  â”œâ”€ predicted_total (FG)
â”‚  â”‚  â”œâ”€ predicted_margin_1h (1H)
â”‚  â”‚  â””â”€ predicted_total_1h (1H)
â”‚  â”‚
â”‚  â””â”€ Injury Features (when available)
â”‚     â”œâ”€ Injury spread impact
â”‚     â””â”€ Star player out indicators
â”‚
â””â”€ Output: Feature dictionary â†’ Model prediction
```

---

## âœ… Endpoint Usage Summary

### Always Called (Essential)
1. **API-Basketball:**
   - `/teams` - 1 call per season
   - `/games` - 1 call per season
   - `/statistics` - 30 calls per season (1 per team)
   - `/games/statistics/teams` - ~25-30 calls per season (batched)

2. **The Odds API:**
   - `/participants` - 1 call at start
   - `/historical/.../odds` or `/odds` - 1 call per date
   - `/events/{id}/odds` - N calls (1 per event for 1H)
   - `/betting-splits` - 1 call (if available)

### Optional (Fallback/Enhancement)
- `/events` - Only if historical unavailable
- Action Network splits - Only if The Odds API splits unavailable

---

## ğŸ” Verification: How to Confirm All Endpoints Are Used

**Check logs for these messages:**

```
âœ“ Fetched 30 participants for team validation
Ingesting: teams
Ingesting: games
Ingesting: statistics
Ingesting: game_stats_teams
Fetching betting lines for 180 unique dates...
âœ“ Historical odds endpoint available
âœ“ Fetched event odds for event {id} (1H markets)
âœ“ Fetched betting splits for 50 games
```

**Count API calls:**
- API-Basketball: ~60-65 calls per season (teams=1, games=1, stats=30, game_stats=~30)
- The Odds API: ~180 calls for dates + N calls for events (1H) + 1 for splits

---

## ğŸ“ Summary

**Total Endpoints Used:** 12+ endpoints across 2 APIs

**API-Basketball:** 4 essential endpoints (Tier 1) always called
**The Odds API:** 5 endpoints (participants, odds, events, event-odds, splits)

**All endpoints are now optimized and being used in the container pipeline!** âœ…
