#
# NBA v5.0 BETA - Production (Single Container)
#
# This compose file intentionally runs ONLY the production inference API.
# Backtesting is intentionally separated into docker-compose.backtest.yml.
#
# Start production:
#   docker compose up -d
#
# Hit API:
#   http://localhost:8090/health
#   http://localhost:8090/slate/today
#
services:
  strict-api:
    build:
      context: .
      dockerfile: Dockerfile
    image: nba-strict-api:latest
    container_name: nba-api
    ports:
      - "8090:8080"
    env_file:
      - .env
    volumes:
      # Optional: local secrets folder (safe if empty)
      - ./secrets:/run/secrets:ro
    environment:
      # Allow runtime overrides (optional)
      - REQUIRE_API_AUTH=${REQUIRE_API_AUTH:-false}
      - ALLOWED_ORIGINS=${ALLOWED_ORIGINS:-http://localhost:3000,http://localhost:8090}
      - DATA_PROCESSED_DIR=/app/data/processed
    restart: unless-stopped
